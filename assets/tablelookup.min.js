var TableLookupWizard=function(){"use strict";return function(e,t){function n(n){var r=n.target.getParent("tr");n.target.checked?(r.removeClass("found").addClass("selected").inject(s.getElement("tr.search"),"before"),t&&t.enableSorting&&(r.getElement(".drag-handle").setStyle("display","inline"),d.addItems(r)),window.fireEvent("tableLookupWizard_postModified",{name:e,operation:"selected",element:r})):(r.destroy(),s.send(l),t&&t.enableSorting&&d.removeItems(r),window.fireEvent("tableLookupWizard_postModified",{name:e,operation:"unselected",element:r}))}function r(e){e.target.getParent("tr").removeClass("found").inject(i,"before"),e.target.getParent("tr").getAllPrevious().destroy(),s.send(l)}function o(){d=new Sortables(s.getElements("tbody"),{constrain:!0,clone:!1,handle:".drag-handle"}),d.getDroppables=function(){return s.getElements("tbody tr.row.selected")},d.removeItems(s.getElements("tbody tr.search"),s.getElements("tbody tr.reset"))}var a,s,l,i,d;s=document.id("ctrl_"+e),i=s.getElement("tr.reset, tr.search"),l=window.location.href+"&tableLookupWizard="+e,t&&t.enableSorting&&o(),s.getElement(".jserror").setStyle("display","none"),s.getElement(".search").setStyle("display",Browser.ie&&Browser.version<8||Browser.Engine&&Browser.Engine.trident&&Browser.Engine.version<6?"block":"table-row"),s.getElements("tbody tr").forEach(function(e){var t=e.getElement("input[type=checkbox]")||e.getElement("input[type=radio]");t&&t.addEvent("change",function(e){e.target.getParent("tr").hasClass("reset")?e.target.getParent("tr").getAllPrevious().destroy():e.target.getParent("tr").destroy(),s.send(l)})}),s.set("send",{method:"get",link:"cancel",onSuccess:function(t){var o;try{t=JSON.decode(t).content}catch(a){}s.getElements(".search input.tl_text").setStyle("background-image","none"),s.getElements("tr.found").destroy(),o=Elements.from(t,!1),s.getElement("tbody").adopt(o),o.forEach(function(e){e.getElement("input[type=checkbox]")&&e.getElement("input[type=checkbox]").addEvent("click",n),e.getElement("input[type=radio]")&&e.getElement("input[type=radio]").addEvent("click",r)}),window.fireEvent("tableLookupWizard_postSearch",{name:e,result:t})}}).addEvent("keyup",function(){clearTimeout(a),a=setTimeout(function(){s.getElement(".search input.tl_text").setStyle("background-image","url(system/modules/tablelookupwizard/assets/loading.gif)"),s.send(l)},300)})}}();
